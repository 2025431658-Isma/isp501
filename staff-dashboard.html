<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Staff Dashboard - Owl Barbershop</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* This is your original UI Style */
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e67e22;
            --bg-color: #f8f9fa;
            --text-color: #333;
            --border-color: #ddd;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        body { background-color: var(--bg-color); color: var(--text-color); line-height: 1.6; }

        .dashboard-container { display: flex; min-height: 100vh; }

        /* Sidebar using your primary color */
        .sidebar { width: 280px; background: var(--primary-color); color: white; padding: 30px 20px; position: fixed; height: 100vh; }
        .sidebar h2 { margin-bottom: 30px; font-size: 1.5rem; text-align: center; }
        .sidebar-nav { list-style: none; }
        .sidebar-nav li { margin-bottom: 15px; }
        .sidebar-nav a { color: rgba(255,255,255,0.8); text-decoration: none; display: flex; align-items: center; padding: 12px 15px; border-radius: 8px; transition: 0.3s; cursor: pointer; }
        .sidebar-nav a:hover, .sidebar-nav a.active { background: rgba(255,255,255,0.1); color: white; }
        .sidebar-nav i { margin-right: 15px; font-size: 1.1rem; }

        .main-content { flex: 1; margin-left: 280px; padding: 40px; }

        /* Your original Table Style */
        .card { background: white; border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); padding: 30px; margin-bottom: 30px; }
        .section-title { margin-bottom: 25px; display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid var(--bg-color); padding-bottom: 15px; }
        
        .bookings-table { width: 100%; border-collapse: collapse; }
        .bookings-table th { background-color: #f8f9fa; padding: 15px; text-align: left; font-weight: 600; color: #666; border-bottom: 2px solid var(--border-color); }
        .bookings-table td { padding: 15px; border-bottom: 1px solid #eee; vertical-align: middle; }
        
        .status-badge { padding: 6px 12px; border-radius: 20px; font-size: 0.85rem; font-weight: 500; }
        .status-confirmed { background: #e8f5e9; color: #2e7d32; }
        .status-pending { background: #fff3e0; color: #ef6c00; }
        .status-cancelled { background: #ffebee; color: #c62828; }

        .btn { padding: 10px 20px; border-radius: 6px; border: none; cursor: pointer; font-weight: 500; transition: 0.3s; }
        .btn-primary { background: var(--secondary-color); color: white; }
        .btn-danger { background: #e74c3c; color: white; }
        
        .hidden { display: none; }
        .staff-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; }
    </style>
</head>
<body>

    <div class="dashboard-container">
        <aside class="sidebar">
            <h2>OWL STAFF</h2>
            <ul class="sidebar-nav">
                <li><a onclick="showSection('my-bookings')" class="active"><i class="fas fa-calendar-check"></i> My Bookings</a></li>
                <li><a onclick="showSection('all-staff')"><i class="fas fa-users"></i> Other Staff</a></li>
                <li><a onclick="showSection('profile')"><i class="fas fa-user-edit"></i> Update Profile</a></li>
                <li><a href="bookings.html"><i class="fas fa-plus-circle"></i> Create Booking</a></li>
                <li style="margin-top: 50px;"><a onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
            </ul>
        </aside>

        <main class="main-content">
            <section id="my-bookings" class="content-section">
                <div class="card">
                    <div class="section-title">
                        <h2>My Assigned Appointments</h2>
                        <span id="staffNameTag" style="color: var(--secondary-color); font-weight: bold;"></span>
                    </div>
                    <table class="bookings-table">
                        <thead>
                            <tr>
                                <th>Customer</th>
                                <th>Service</th>
                                <th>Date & Time</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="staffTableBody"></tbody>
                    </table>
                </div>
            </section>

            <section id="all-staff" class="content-section hidden">
                <div class="card">
                    <div class="section-title"><h2>Other Barbers</h2></div>
                    <div class="staff-grid" id="staffGridBody"></div>
                </div>
            </section>

            <section id="profile" class="content-section hidden">
                <div class="card">
                    <div class="section-title"><h2>My Profile Settings</h2></div>
                    <div style="max-width: 400px;">
                        <p><strong>Email:</strong> <span id="displayEmail"></span></p><br>
                        <label>Display Name:</label>
                        <input type="text" id="updateName" style="width:100%; padding:10px; margin:10px 0;">
                        <button class="btn btn-primary" onclick="saveProfile()">Save Changes</button>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script>
        // Use the same logic as your previous pages
        let currentUser = JSON.parse(localStorage.getItem('owl_user'));

        document.addEventListener('DOMContentLoaded', function() {
            if (!currentUser || currentUser.role !== 'staff') {
                window.location.href = 'login.html';
                return;
            }
            document.getElementById('staffNameTag').textContent = currentUser.full_name;
            loadStaffData();
        });

        function showSection(sectionId) {
            document.querySelectorAll('.content-section').forEach(s => s.classList.add('hidden'));
            document.querySelectorAll('.sidebar-nav a').forEach(a => a.classList.remove('active'));
            document.getElementById(sectionId).classList.remove('hidden');
            event.currentTarget.classList.add('active');
            
            if(sectionId === 'all-staff') loadOtherBarbers();
            if(sectionId === 'profile') {
                document.getElementById('displayEmail').textContent = currentUser.email;
                document.getElementById('updateName').value = currentUser.full_name;
            }
        }

        function loadStaffData() {
            const allBookings = JSON.parse(localStorage.getItem('owl_bookings')) || [];
            
            // FILTER: Compare booking.barber with the logged in staff name
            const myBookings = allBookings.filter(b => b.barber === currentUser.full_name);
            
            const tbody = document.getElementById('staffTableBody');
            tbody.innerHTML = '';

            myBookings.forEach(booking => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${booking.customer.name}</strong><br><small>${booking.customer.phone}</small></td>
                    <td>${booking.service}</td>
                    <td>${booking.date} at ${booking.time}</td>
                    <td><span class="status-badge status-${booking.status}">${booking.status}</span></td>
                    <td>
                        <button class="btn btn-danger" onclick="cancelBooking('${booking.id}')">Cancel</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function loadOtherBarbers() {
            const users = JSON.parse(localStorage.getItem('owl_users')) || [];
            const staffList = users.filter(u => u.role === 'staff');
            const grid = document.getElementById('staffGridBody');
            grid.innerHTML = staffList.map(s => `
                <div class="card" style="text-align:center;">
                    <i class="fas fa-user-circle fa-3x" style="color:var(--primary-color)"></i>
                    <h3>${s.full_name}</h3>
                    <p>${s.email}</p>
                </div>
            `).join('');
        }

        function saveProfile() {
            const newName = document.getElementById('updateName').value;
            let users = JSON.parse(localStorage.getItem('owl_users')) || [];
            const idx = users.findIndex(u => u.email === currentUser.email);
            
            if(idx !== -1) {
                users[idx].full_name = newName;
                localStorage.setItem('owl_users', JSON.stringify(users));
                currentUser.full_name = newName;
                localStorage.setItem('owl_user', JSON.stringify(currentUser));
                alert("Profile Updated!");
                location.reload();
            }
        }

        function cancelBooking(id) {
            if(confirm("Cancel this booking?")) {
                let bookings = JSON.parse(localStorage.getItem('owl_bookings')) || [];
                const idx = bookings.findIndex(b => b.id === id);
                if(idx !== -1) {
                    bookings[idx].status = 'cancelled';
                    localStorage.setItem('owl_bookings', JSON.stringify(bookings));
                    loadStaffData();
                }
            }
        }

        function logout() {
            localStorage.removeItem('owl_user');
            window.location.href = 'login.html';
        }
    </script>
</body>
</html>
