<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Staff Dashboard - Owl Barbershop</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --bg-color: #f4f7f6;
            --text-color: #333;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        body { background-color: var(--bg-color); display: flex; }

        /* Sidebar UI */
        .sidebar { width: 260px; background: var(--primary-color); color: white; height: 100vh; position: fixed; padding: 20px; }
        .sidebar h2 { margin-bottom: 30px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 15px; }
        .sidebar-nav { list-style: none; }
        .sidebar-nav li { margin-bottom: 10px; }
        .sidebar-nav a { color: #bdc3c7; text-decoration: none; display: flex; align-items: center; padding: 12px; border-radius: 8px; cursor: pointer; }
        .sidebar-nav a:hover, .sidebar-nav a.active { background: var(--secondary-color); color: white; }
        .sidebar-nav i { margin-right: 10px; width: 20px; }

        /* Main Content UI */
        .main-content { flex: 1; margin-left: 260px; padding: 40px; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }

        /* Your Statistics UI */
        .stats-container { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); text-align: center; }
        .stat-card h3 { font-size: 2rem; color: var(--primary-color); }
        .stat-card p { color: #666; font-size: 0.9rem; }

        /* Your Table UI */
        .table-container { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; padding: 15px; color: #7f8c8d; border-bottom: 2px solid #f4f7f6; }
        td { padding: 15px; border-bottom: 1px solid #f4f7f6; }

        /* Your Status & Button Classes */
        .status-badge { padding: 5px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: 500; text-transform: capitalize; }
        .status-confirmed { background: #e8f5e9; color: #27ae60; }
        .status-pending { background: #fff8e1; color: #f39c12; }
        .status-cancelled { background: #fdf2f2; color: #e74c3c; }

        .btn-icon { background: none; border: none; cursor: pointer; padding: 5px; font-size: 1.1rem; transition: 0.2s; }
        .btn-view { color: var(--secondary-color); }
        .btn-cancel { color: #e74c3c; }
        
        .hidden { display: none; }
    </style>
</head>
<body>

    <aside class="sidebar">
        <h2>Owl Staff</h2>
        <ul class="sidebar-nav">
            <li><a onclick="showSection('my-bookings')" class="active"><i class="fas fa-calendar-check"></i> My Appointments</a></li>
            <li><a onclick="showSection('staff-list')"><i class="fas fa-users"></i> View Other Staff</a></li>
            <li><a onclick="showSection('profile-section')"><i class="fas fa-user-edit"></i> My Profile</a></li>
            <li><a href="bookings.html"><i class="fas fa-plus"></i> Create Booking</a></li>
            <li style="margin-top: 50px;"><a onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
        </ul>
    </aside>

    <main class="main-content">
        <div id="my-bookings" class="section">
            <div class="header">
                <h1>My Appointments</h1>
                <p>Logged in as: <strong id="loggedInStaffName">...</strong></p>
            </div>

            <div class="stats-container">
                <div class="stat-card"><h3><span id="totalBookings">0</span></h3><p>Assigned to Me</p></div>
                <div class="stat-card"><h3><span id="upcomingBookings">0</span></h3><p>Upcoming</p></div>
                <div class="stat-card"><h3><span id="pendingBookings">0</span></h3><p>Pending</p></div>
                <div class="stat-card"><h3><span id="cancelledBookings">0</span></h3><p>Cancelled</p></div>
            </div>

            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Customer</th>
                            <th>Service</th>
                            <th>Date & Time</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody"></tbody>
                </table>
            </div>
        </div>

        <div id="staff-list" class="section hidden">
            <h1>Other Barbers</h1>
            <div class="table-container" style="margin-top:20px;">
                <table id="allStaffTable">
                    <thead><tr><th>Name</th><th>Email</th><th>Status</th></tr></thead>
                    <tbody id="staffTableBody"></tbody>
                </table>
            </div>
        </div>

        <div id="profile-section" class="section hidden">
            <h1>Update Profile</h1>
            <div class="table-container" style="margin-top:20px; max-width: 500px;">
                <label>Full Name</label>
                <input type="text" id="editFullName" style="width:100%; padding:10px; margin:10px 0;">
                <button onclick="saveProfile()" class="sidebar-nav" style="background:var(--secondary-color); color:white; border:none; padding:10px 20px; border-radius:5px; width:100%;">Save Changes</button>
            </div>
        </div>
    </main>

    <script>
        let currentUser = JSON.parse(localStorage.getItem('owl_user'));
        let allBookings = [];

        document.addEventListener('DOMContentLoaded', () => {
            if (!currentUser || currentUser.role !== 'staff') {
                window.location.href = 'login.html';
                return;
            }
            document.getElementById('loggedInStaffName').textContent = currentUser.full_name;
            loadData();
        });

        function showSection(id) {
            document.querySelectorAll('.section').forEach(s => s.classList.add('hidden'));
            document.querySelectorAll('.sidebar-nav a').forEach(a => a.classList.remove('active'));
            document.getElementById(id).classList.remove('hidden');
            event.currentTarget.classList.add('active');
            
            if(id === 'staff-list') loadStaffMembers();
        }

        function loadData() {
            const storedBookings = JSON.parse(localStorage.getItem('owl_bookings')) || [];
            // FILTER BY STAFF NAME
            allBookings = storedBookings.filter(b => b.barber === currentUser.full_name);
            
            const tableBody = document.getElementById('tableBody');
            tableBody.innerHTML = '';

            allBookings.forEach(booking => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${booking.id}</td>
                    <td><strong>${booking.customer.name}</strong><br><small>${booking.customer.phone}</small></td>
                    <td>${booking.service}</td>
                    <td>${booking.date}<br><small>${booking.time}</small></td>
                    <td><span class="status-badge status-${booking.status}">${booking.status}</span></td>
                    <td>
                        <button class="btn-icon btn-cancel" onclick="cancelBooking('${booking.id}')" title="Cancel">
                            <i class="fas fa-times"></i>
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            updateStatistics();
        }

        function updateStatistics() {
            document.getElementById('totalBookings').textContent = allBookings.length;
            document.getElementById('pendingBookings').textContent = allBookings.filter(b => b.status === 'pending').length;
            document.getElementById('cancelledBookings').textContent = allBookings.filter(b => b.status === 'cancelled').length;
            document.getElementById('upcomingBookings').textContent = allBookings.filter(b => b.status === 'confirmed').length;
        }

        function loadStaffMembers() {
            const users = JSON.parse(localStorage.getItem('owl_users')) || [];
            const staff = users.filter(u => u.role === 'staff');
            const tbody = document.getElementById('staffTableBody');
            tbody.innerHTML = staff.map(s => `<tr><td>${s.full_name}</td><td>${s.email}</td><td>Active</td></tr>`).join('');
        }

        function cancelBooking(id) {
            if (confirm('Cancel this booking?')) {
                let globalBookings = JSON.parse(localStorage.getItem('owl_bookings'));
                const index = globalBookings.findIndex(b => b.id === id);
                if (index !== -1) {
                    globalBookings[index].status = 'cancelled';
                    localStorage.setItem('owl_bookings', JSON.stringify(globalBookings));
                    loadData();
                }
            }
        }

        function logout() {
            localStorage.removeItem('owl_user');
            window.location.href = 'index.html';
        }
    </script>
</body>
</html>
